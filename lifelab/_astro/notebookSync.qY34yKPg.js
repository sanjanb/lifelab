import{a as u,g as f,b as D}from"./storage.mmsOLJq4.js";import{g as m}from"./config.BPkNxJtt.js";function b(o,r,t){const e=new Set,n=new Date(r,t-1,1),s=new Date(r,t,0,23,59,59,999);return o.forEach(i=>{if(!i.timestamp)return;const a=new Date(i.timestamp);if(a>=n&&a<=s){const g=a.toISOString().split("T")[0];e.add(g)}}),e}function y(o,r,t){try{if(!o)return console.error("aggregateDomainToNotebook: domainId is required"),!1;if(!Number.isInteger(r)||!Number.isInteger(t))return console.error("aggregateDomainToNotebook: year and month must be integers"),!1;let e=u(r,t);e||(e=S(r,t));const n=f(o),s=b(n,r,t);return Object.keys(e.days).forEach(i=>{const a=e.days[i],g=a.date||`${r}-${String(t).padStart(2,"0")}-${i.padStart(2,"0")}`,l=s.has(g),c=a.domains||[];l&&!c.includes(o)?a.domains=[...c,o]:!l&&c.includes(o)&&(a.domains=c.filter(d=>d!==o))}),D(e)}catch(e){return console.error("aggregateDomainToNotebook error:",e),!1}}function S(o,r){const t=new Date(o,r,0).getDate(),e={};for(let n=1;n<=t;n++){const s=String(n),a=new Date(o,r-1,n).toISOString().split("T")[0];e[s]={date:a,domains:[]}}return{year:o,month:r,days:e,_created:new Date().toISOString()}}function p(o,r){try{const t=m();if(!t||t.length===0)return console.warn("aggregateAllDomainsToNotebook: no domains configured"),!0;let e=!0;return t.forEach(n=>{y(n.id,o,r)||(console.warn(`Failed to aggregate domain: ${n.id}`),e=!1)}),e}catch(t){return console.error("aggregateAllDomainsToNotebook error:",t),!1}}function T(o,r,t){try{const e=u(o,r);if(!e)return null;const n=String(t),s=e.days[n];return s?[...s.domains||[]]:(console.error("getDomainPresenceForDay: invalid day number"),null)}catch(e){return console.error("getDomainPresenceForDay error:",e),null}}export{y as a,p as b,T as g};
