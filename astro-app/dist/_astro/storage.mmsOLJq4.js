import{a as c}from"./config.BPkNxJtt.js";function p(e,r){try{if(typeof window>"u"||typeof localStorage>"u")return!1;if(!e||!r)return console.error("saveEntry: domainId and entry are required"),!1;const t=c(e);if(!t)return console.error(`saveEntry: No storage key found for domain ${e}`),!1;const o=f(e),a=o.findIndex(n=>n.id===r.id);return a!==-1?o[a]=r:o.push(r),localStorage.setItem(t,JSON.stringify(o)),!0}catch(t){return console.error("saveEntry error:",t),!1}}function f(e){try{if(typeof window>"u"||typeof localStorage>"u")return[];if(!e)return console.error("getEntries: domainId is required"),[];const r=c(e);if(!r)return console.error(`getEntries: No storage key found for domain ${e}`),[];const t=localStorage.getItem(r);return t?JSON.parse(t):[]}catch(r){return console.error("getEntries error:",r),[]}}function m(e,r){try{if(typeof window>"u"||typeof localStorage>"u")return!1;if(!e||!r)return console.error("deleteEntry: domainId and entryId are required"),!1;const t=c(e);if(!t)return console.error(`deleteEntry: No storage key found for domain ${e}`),!1;const o=f(e),a=o.filter(n=>n.id!==r);return a.length===o.length?(console.warn(`deleteEntry: Entry ${r} not found in ${e}`),!1):(localStorage.setItem(t,JSON.stringify(a)),!0)}catch(t){return console.error("deleteEntry error:",t),!1}}function u(e,r){const t=String(r).padStart(2,"0");return`lifelab_notebook_${e}_${t}`}function h(e,r){try{if(typeof window>"u"||typeof localStorage>"u")return null;if(!Number.isInteger(e)||!Number.isInteger(r))return console.error("getMonthlyNotebook: year and month must be integers"),null;if(r<1||r>12)return console.error("getMonthlyNotebook: month must be between 1 and 12"),null;const t=u(e,r),o=localStorage.getItem(t);return o?JSON.parse(o):null}catch(t){return console.error("getMonthlyNotebook error:",t),null}}function w(e){try{if(typeof window>"u"||typeof localStorage>"u")return!1;if(!e||typeof e!="object")return console.error("saveMonthlyNotebook: notebook must be an object"),!1;if(!e.year||!e.month)return console.error("saveMonthlyNotebook: notebook missing year or month"),!1;const r=u(e.year,e.month);return e._lastModified=new Date().toISOString(),localStorage.setItem(r,JSON.stringify(e)),!0}catch(r){return console.error("saveMonthlyNotebook error:",r),!1}}function g(){if(typeof window>"u"||typeof localStorage>"u")throw new Error("Export only available in browser environment");const e={version:"1.0.0",exportDate:new Date().toISOString(),domains:{},notebooks:{}};for(let r=0;r<localStorage.length;r++){const t=localStorage.key(r);if(t)try{const o=localStorage.getItem(t);if(!o)continue;t.startsWith("lifelab_")&&!t.includes("notebook")?e.domains[t]=JSON.parse(o):t.startsWith("lifelab_notebook_")&&(e.notebooks[t]=JSON.parse(o))}catch(o){console.error(`Error exporting ${t}:`,o)}}return e}function b(e){try{const r=g(),t=JSON.stringify(r,null,2),o=new Blob([t],{type:"application/json"}),a=URL.createObjectURL(o),n=document.createElement("a");n.href=a,n.download=e||`lifelab-backup-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a)}catch(r){throw console.error("Download export error:",r),r}}function y(e,r="merge"){if(typeof window>"u"||typeof localStorage>"u")throw new Error("Import only available in browser environment");let t=0,o=0;try{if(r==="replace"){const a=[];for(let n=0;n<localStorage.length;n++){const i=localStorage.key(n);i&&i.startsWith("lifelab_")&&a.push(i)}a.forEach(n=>localStorage.removeItem(n))}return Object.entries(e.domains).forEach(([a,n])=>{try{if(r==="merge"){const i=getStorageItem(a)||[],s=new Set(i.map(l=>l.id)),d=n.filter(l=>!s.has(l.id));localStorage.setItem(a,JSON.stringify([...i,...d]))}else localStorage.setItem(a,JSON.stringify(n));t++}catch(i){console.error(`Error importing ${a}:`,i),o++}}),Object.entries(e.notebooks).forEach(([a,n])=>{try{if(r==="merge"){const i=getStorageItem(a);i&&(n.days={...i.days,...n.days},n.reflection=n.reflection||i.reflection)}localStorage.setItem(a,JSON.stringify(n)),t++}catch(i){console.error(`Error importing ${a}:`,i),o++}}),{success:o===0,imported:t,errors:o}}catch(a){throw console.error("Import data error:",a),a}}async function E(e,r="merge"){try{const t=await e.text(),o=JSON.parse(t);if(!o.version||!o.domains||!o.notebooks)throw new Error("Invalid LifeLab export file format");return y(o,r)}catch(t){throw console.error("Import from file error:",t),t}}function N(){if(typeof window>"u"||typeof localStorage>"u")return{totalEntries:0,totalNotebooks:0,domains:{},estimatedSize:0};let e=0,r=0,t=0;const o={};for(let a=0;a<localStorage.length;a++){const n=localStorage.key(a);if(!(!n||!n.startsWith("lifelab_")))try{const i=localStorage.getItem(n);if(!i)continue;if(t+=i.length,n.includes("notebook"))r++;else{const s=JSON.parse(i);e+=s.length,o[n]=s.length}}catch(i){console.error(`Error reading ${n}:`,i)}}return{totalEntries:e,totalNotebooks:r,domains:o,estimatedSize:t}}export{h as a,w as b,N as c,m as d,b as e,f as g,E as i,p as s};
