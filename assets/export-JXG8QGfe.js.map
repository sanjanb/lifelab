{"version":3,"file":"export-JXG8QGfe.js","sources":["../../src/data/export.js"],"sourcesContent":["/**\r\n * Export/Import Utilities\r\n * Data portability and backup functionality\r\n */\r\n\r\n/**\r\n * Exports monthly data as JSON file\r\n * @param {Array} data - Array of day records\r\n * @param {number} year - Year\r\n * @param {number} month - Month\r\n */\r\nexport function exportToJSON(data, year, month) {\r\n  const monthStr = String(month).padStart(2, \"0\");\r\n  const filename = `lifelab-${year}-${monthStr}.json`;\r\n\r\n  const jsonStr = JSON.stringify(data, null, 2);\r\n  downloadFile(jsonStr, filename, \"application/json\");\r\n}\r\n\r\n/**\r\n * Exports data as CSV\r\n * @param {Array} data - Array of day records\r\n * @param {string} filename - Output filename\r\n */\r\nexport function exportToCSV(data, filename = \"lifelab-export.csv\") {\r\n  // Get all unique domains\r\n  const domains = new Set();\r\n  data.forEach((day) => {\r\n    if (day.domains) {\r\n      Object.keys(day.domains).forEach((d) => domains.add(d));\r\n    }\r\n  });\r\n\r\n  const domainList = Array.from(domains).sort();\r\n\r\n  // Create CSV header\r\n  const header = [\"Date\", ...domainList, \"Notes\"].join(\",\");\r\n\r\n  // Create CSV rows\r\n  const rows = data.map((day) => {\r\n    const values = [\r\n      day.date,\r\n      ...domainList.map((d) => day.domains[d] || \"\"),\r\n      `\"${(day.notes || \"\").replace(/\"/g, '\"\"')}\"`,\r\n    ];\r\n    return values.join(\",\");\r\n  });\r\n\r\n  const csv = [header, ...rows].join(\"\\n\");\r\n  downloadFile(csv, filename, \"text/csv\");\r\n}\r\n\r\n/**\r\n * Imports data from JSON file\r\n * @param {File} file - File object\r\n * @returns {Promise<Array>} Promise resolving to array of day records\r\n */\r\nexport async function importFromJSON(file) {\r\n  return new Promise((resolve, reject) => {\r\n    const reader = new FileReader();\r\n\r\n    reader.onload = (e) => {\r\n      try {\r\n        const data = JSON.parse(e.target.result);\r\n\r\n        if (!Array.isArray(data)) {\r\n          throw new Error(\"Invalid format: expected array of day records\");\r\n        }\r\n\r\n        // Basic validation\r\n        const valid = data.every(\r\n          (day) => day.date && day.domains && typeof day.domains === \"object\"\r\n        );\r\n\r\n        if (!valid) {\r\n          throw new Error(\"Invalid day records found\");\r\n        }\r\n\r\n        resolve(data);\r\n      } catch (error) {\r\n        reject(error);\r\n      }\r\n    };\r\n\r\n    reader.onerror = () => reject(new Error(\"Failed to read file\"));\r\n    reader.readAsText(file);\r\n  });\r\n}\r\n\r\n/**\r\n * Exports all available data as a single backup file\r\n * @param {Object} allData - Object mapping month keys to data arrays\r\n */\r\nexport function exportFullBackup(allData) {\r\n  const backup = {\r\n    exportDate: new Date().toISOString(),\r\n    version: \"1.0\",\r\n    data: allData,\r\n  };\r\n\r\n  const filename = `lifelab-backup-${\r\n    new Date().toISOString().split(\"T\")[0]\r\n  }.json`;\r\n  const jsonStr = JSON.stringify(backup, null, 2);\r\n  downloadFile(jsonStr, filename, \"application/json\");\r\n}\r\n\r\n/**\r\n * Helper: Download a file\r\n */\r\nfunction downloadFile(content, filename, mimeType) {\r\n  const blob = new Blob([content], { type: mimeType });\r\n  const url = URL.createObjectURL(blob);\r\n\r\n  const link = document.createElement(\"a\");\r\n  link.href = url;\r\n  link.download = filename;\r\n  link.click();\r\n\r\n  URL.revokeObjectURL(url);\r\n}\r\n\r\n/**\r\n * Renders import/export UI\r\n */\r\nexport function renderImportExportUI(container, currentData, onImport) {\r\n  container.innerHTML = `\r\n    <div class=\"import-export-section\">\r\n      <h3>Export Data</h3>\r\n      <div class=\"export-buttons\">\r\n        <button class=\"btn-secondary\" id=\"export-json\">Export as JSON</button>\r\n        <button class=\"btn-secondary\" id=\"export-csv\">Export as CSV</button>\r\n      </div>\r\n      \r\n      <h3>Import Data</h3>\r\n      <div class=\"import-area\">\r\n        <input type=\"file\" id=\"import-file\" accept=\".json\" />\r\n        <button class=\"btn-primary\" id=\"import-data\">Import JSON</button>\r\n      </div>\r\n      \r\n      <div class=\"import-hint\">\r\n        üìÅ Import will merge with existing data. Duplicate dates will be overwritten.\r\n      </div>\r\n    </div>\r\n  `;\r\n\r\n  // Export handlers\r\n  container.querySelector(\"#export-json\").addEventListener(\"click\", () => {\r\n    const now = new Date();\r\n    exportToJSON(currentData, now.getFullYear(), now.getMonth() + 1);\r\n  });\r\n\r\n  container.querySelector(\"#export-csv\").addEventListener(\"click\", () => {\r\n    exportToCSV(currentData);\r\n  });\r\n\r\n  // Import handler\r\n  container\r\n    .querySelector(\"#import-data\")\r\n    .addEventListener(\"click\", async () => {\r\n      const fileInput = container.querySelector(\"#import-file\");\r\n      const file = fileInput.files[0];\r\n\r\n      if (!file) {\r\n        alert(\"Please select a file to import\");\r\n        return;\r\n      }\r\n\r\n      try {\r\n        const importedData = await importFromJSON(file);\r\n        if (onImport) onImport(importedData);\r\n        alert(`Successfully imported ${importedData.length} entries`);\r\n      } catch (error) {\r\n        alert(`Import failed: ${error.message}`);\r\n      }\r\n    });\r\n}\r\n"],"names":["exportToJSON","data","year","month","filename","String","padStart","downloadFile","JSON","stringify","exportToCSV","domains","Set","forEach","day","Object","keys","d","add","domainList","Array","from","sort","join","map","date","notes","replace","exportFullBackup","allData","backup","exportDate","Date","toISOString","version","split","content","mimeType","blob","Blob","type","url","URL","createObjectURL","link","document","createElement","href","download","click","revokeObjectURL","renderImportExportUI","container","currentData","onImport","innerHTML","querySelector","addEventListener","now","getFullYear","getMonth","async","file","files","importedData","Promise","resolve","reject","reader","FileReader","onload","e","parse","target","result","isArray","Error","every","error","onerror","readAsText","importFromJSON","alert","length","message"],"mappings":"AAWO,SAASA,EAAaC,EAAMC,EAAMC,GACvC,MACMC,EAAW,WAAWF,KADXG,OAAOF,GAAOG,SAAS,EAAG,YAI3CC,EADgBC,KAAKC,UAAUR,EAAM,KAAM,GACrBG,EAAU,mBAClC,CAOO,SAASM,EAAYT,EAAMG,EAAW,sBAE3C,MAAMO,MAAcC,IACpBX,EAAKY,QAASC,IACRA,EAAIH,SACNI,OAAOC,KAAKF,EAAIH,SAASE,QAASI,GAAMN,EAAQO,IAAID,MAIxD,MAAME,EAAaC,MAAMC,KAAKV,GAASW,OAgBvCf,EADY,CAZG,CAAC,UAAWY,EAAY,SAASI,KAAK,QAGxCtB,EAAKuB,IAAKV,GACN,CACbA,EAAIW,QACDN,EAAWK,IAAKP,GAAMH,EAAIH,QAAQM,IAAM,IAC3C,KAAKH,EAAIY,OAAS,IAAIC,QAAQ,KAAM,UAExBJ,KAAK,OAGSA,KAAK,MACjBnB,EAAU,WAC9B,CA2CO,SAASwB,EAAiBC,GAC/B,MAAMC,EAAS,CACbC,YAAA,IAAgBC,MAAOC,cACvBC,QAAS,MACTjC,KAAM4B,GAGFzB,EAAW,mBAAA,IACX4B,MAAOC,cAAcE,MAAM,KAAK,UAGtC5B,EADgBC,KAAKC,UAAUqB,EAAQ,KAAM,GACvB1B,EAAU,mBAClC,CAKA,SAASG,EAAa6B,EAAShC,EAAUiC,GACvC,MAAMC,EAAO,IAAIC,KAAK,CAACH,GAAU,CAAEI,KAAMH,IACnCI,EAAMC,IAAIC,gBAAgBL,GAE1BM,EAAOC,SAASC,cAAc,KACpCF,EAAKG,KAAON,EACZG,EAAKI,SAAW5C,EAChBwC,EAAKK,QAELP,IAAIQ,gBAAgBT,EACtB,CAKO,SAASU,EAAqBC,EAAWC,EAAaC,GAC3DF,EAAUG,UAAY,mpBAqBtBH,EAAUI,cAAc,gBAAgBC,iBAAiB,QAAS,KAChE,MAAMC,MAAU1B,KAChBhC,EAAaqD,EAAaK,EAAIC,cAAeD,EAAIE,WAAa,KAGhER,EAAUI,cAAc,eAAeC,iBAAiB,QAAS,KAC/D/C,EAAY2C,KAIdD,EACGI,cAAc,gBACdC,iBAAiB,QAASI,UACzB,MACMC,EADYV,EAAUI,cAAc,gBACnBO,MAAM,GAE7B,GAAKD,EAKL,IACE,MAAME,QAhHPH,eAA8BC,GACnC,OAAO,IAAIG,QAAQ,CAACC,EAASC,KAC3B,MAAMC,EAAS,IAAIC,WAEnBD,EAAOE,OAAUC,IACf,IACE,MAAMtE,EAAOO,KAAKgE,MAAMD,EAAEE,OAAOC,QAEjC,IAAKtD,MAAMuD,QAAQ1E,GACjB,MAAM,IAAI2E,MAAM,iDAQlB,IAJc3E,EAAK4E,MAChB/D,GAAQA,EAAIW,MAAQX,EAAIH,SAAkC,iBAAhBG,EAAIH,SAI/C,MAAM,IAAIiE,MAAM,6BAGlBV,EAAQjE,EACV,OAAS6E,GACPX,EAAOW,EACT,GAGFV,EAAOW,QAAU,IAAMZ,EAAO,IAAIS,MAAM,wBACxCR,EAAOY,WAAWlB,IAEtB,CAkFmCmB,CAAenB,GACtCR,KAAmBU,GACvBkB,MAAM,yBAAyBlB,EAAamB,iBAC9C,OAASL,GACPI,MAAM,kBAAkBJ,EAAMM,UAChC,MAVEF,MAAM,mCAYd"}